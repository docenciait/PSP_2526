# 2.5 Anexo II - Curl

Curl está diseñado para verificar la conectividad a URLs y transferir datos, especialmente útil para servicios basados en API REST, tanto en pruebas como en producción.

Curl es una herramienta de línea de comandos para hacer peticiones HTTP desde la consola. Su uso principal es obtener respuestas de sitios web o comprobar tiempos de respuesta.

## ¿Qué significa curl?

La herramienta fue pensada para subir y descargar información usando una URL. Es una aplicación cliente (de ahí la 'c'), y a su vez es un cliente de URLs: **cURL**.

En inglés "curl" se pronuncia /k/, rimando con "girl". Si lo deletreamos como c-URL, también puede interpretarse como "ver-URL" (see-URL).

Curl funciona con protocolos que permiten la transferencia de datos en una o dos direcciones. Soporta protocolos basados en una "URI" descritos en una RFC, por lo que curl funciona principalmente con URLs (URIs) como origen y/o destino de las transferencias.

Actualmente curl soporta los siguientes protocolos:

`DICT, FILE, FTP, FTPS, GOPHER, GOPHERS, HTTP, HTTPS, IMAP, IMAPS, LDAP, LDAPS, MQTT, POP3, POP3S, RTMP, RTSP, SCP, SFTP, SMB, SMBS, SMTP, SMTPS, TELNET, TFTP.`

---

## I.1 Cómo obtener curl

Curl es libre, abierto y disponible en varios formatos. Puede descargarse y configurarse en la mayoría de sistemas operativos y arquitecturas hardware. Algunos SO ya lo incluyen.

- **Linux (Ubuntu/Debian):**  
   curl viene instalado por defecto. Para instalar o actualizar:

  ```sh
  apt install curl
  ```

- **Windows 10:**  
   Incluye curl desde la versión 1804.  
   Se puede descargar la última versión desde [curl windows binaries](https://curl.se/windows/).

- **MacOS:**  
   Incluye curl de serie. Para actualizar, se recomienda instalar homebrew:
  ```sh
  brew install curl
  ```

---

## II.2 Realizando una petición GET

La sintaxis básica de Curl es:

```sh
curl [OPTIONS] [URL]
```

Ejemplo simple para mostrar el contenido de una página:

```sh
curl testdomain.com
```

Si no se especifica protocolo, curl usa HTTP por defecto.

```sh
curl http://www.net.net
```

Para guardar la salida en un archivo:

```sh
curl -o output.html www.net.net
```

o equivalente:

```sh
curl www.net.net > output.html
```

Usando el modificador `-s` (--silent) se puede alterar el orden de los argumentos:

```sh
curl -s http://www.net.net -o output.html
```

Para seguir redirecciones, usar `-L` (--location):

```sh
curl -L http://www.dataden.tech
curl -L http://www.net.net
```

Para ver las cabeceras HTTP de la solicitud y respuesta, usar `-v` (--verbose):

```sh
curl -v http://www.net.net
```

Las cabeceras de la solicitud (REQUEST) se muestran con `>`, las de la respuesta (RESPONSE) con `<`.

---

### Formato corto y largo de los parámetros

- **Formato corto:**  
   Un guión seguido de la letra de la opción.  
   Ejemplo:

  ```sh
  curl -v -L http://example.com
  curl -vL http://example.com
  ```

- **Formato largo:**  
   Dos guiones y la palabra de la opción.  
   Ejemplo:
  ```sh
  curl --verbose --location http://example.com
  ```

Para incluir cabeceras en la respuesta:

- `-i` (--include): respuesta completa (headers & data)
- `-I` (--head): solo los headers

```sh
curl -I https://jsonplaceholder.typicode.com/todos/1
```

Para ver el tiempo total de respuesta:

```sh
curl -w "%{time_total}\n" ...
```

---

## II.2 Puntos finales y rutas

**Endpoint:** URL utilizada para hacer una petición a un servicio/API REST.

Ejemplo de endpoint:

```
GET https://my-api.com/Library/Books
```

Devuelve la lista de libros.

**Ruta:** Parte de la URL que completa al endpoint para acceder a componentes específicos.

Ejemplo de ruta:

```
GET https://my-api.com/Library/Books/341
```

Devuelve el libro con ID 341.

Ejemplo en SWAPI (Star Wars API):

```sh
curl https://swapi.dev/api/people/1
curl https://swapi.dev/api/planet/3
curl https://swapi.dev/api/vehicles
```

---

## II.3 Métodos HTTP y cabeceras

Las peticiones HTTP tienen un método (verbo) asociado: GET, POST, HEAD, PUT, etc.

**POST:** Para enviar y recibir información, como formularios web.

Para enviar datos con curl:

```sh
curl -d 'name=admin&shoesize=12' http://example.com/
```

Curl selecciona el método HTTP según las opciones.

- `-d`: POST
- `-I`: HEAD
- `-X`: especifica el método

```sh
curl -X POST -d 'imageSize=big&imageType=jpg' http://example.org/
```

Por defecto, con `-d` se añade la cabecera `Content-Type: application/x-www-form-urlencoded`.

Para enviar datos en formato JSON:

```sh
curl -X POST -d '{"imageSize":"big","imageType":"jpg","scale":"false"}' -H 'Content-Type: application/json' https://example.com
```

---

## II.4 Autenticación

Las solicitudes HTTP pueden requerir autenticación.  
En curl, se usa `-u` (--user) para usuario y contraseña:

```sh
curl --user usuario:contraseña http://example.com/
```

Esto utiliza el método "Basic".

Algunos servicios usan una secret key o Authorization token.

Ejemplo con Azure Translator API:

```sh
curl -X POST "https://api.cognitive.microsofttranslator.com/translate?api-version=3.0&to=en&to=it" \
    -H "Ocp-Apim-Subscription-Key: <tu clave>" \
    -H "Content-Type: application/json; charset=UTF-8" \
    -d "[{'Text':'Hola, com esteu?'}]"
```

Para usar un Authorization token:

```sh
curl -X POST "https://api.cognitive.microsoft.com/sts/v1.0/issueToken" \
    -H "Ocp-Apim-Subscription-Key: <tu clave>" \
    -d {}
```

Luego, usar el token en la cabecera:

```sh
curl -X POST "https://api.cognitive.microsofttranslator.com/translate?api-version=3.0&to=en&to=it" \
    -H "Authorization: Bearer <token>" \
    -H "Content-Type: application/json; charset=UTF-8" \
    -d "[{'Text':'Hola, com esteu?'}]"
```

---

## II.5 Referencias

- [freecodecamp.org](https://www.freecodecamp.org/news/how-to-start-using-curl-and-why-a-hands-on-introduction-ea1c913caaaa/)
- [Sitio oficial de curl](https://curl.se/)
